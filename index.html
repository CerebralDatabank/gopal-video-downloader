<!DOCTYPE html>
<html>
  <head>
    <title>Gopal's Video Downloader</title>
    <link rel="stylesheet" type="text/css" href="./gogo.css">
    <style>
      body {
        font-family: "Segoe UI", "Arial", sans-serif;
      }
      #url-input {
        background: #EEE;
        border: none;
        color: #333;
        font: 14px "Segoe UI", "Arial", sans-serif;
        border-radius: 4px 0 0 4px;
        width: 320px;
        padding: 5px 10px;
      }
      #url-input-submit {
        background: #0C0;
        border: none;
        color: #FFF;
        font: 16px "Segoe UI", "Arial", sans-serif;
        border-radius: 0 4px 4px 0;
        padding: 5px 10px;
      }
      #url-input-submit:hover {
        background: #0A0;
      }
      #url-input-submit:active {
        background: #008000;
      }
      #url-input-submit:disabled {
        background: #0C0;
        opacity: 0.6;
      }
      #log {
        min-width: 200px;
        min-height: 100px;
        width: 320px;
        height: 200px;
        resize: both;
        overflow: auto;
        padding: 10px;
        font: 14px "Consolas", monospace;
        border: 1px solid #000;
        padding: 10px;
      }
      select, option {
        font-size: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Gopal's Video Downloader</h1>
    <p>A simple video downloader.</p>
    <div style="display: flex;">
      <input type="text" id="url-input" placeholder="Video URL or YouTube&trade; Video ID" spellcheck="false">
      <button id="url-input-submit" onclick="processInput(document.getElementById('url-input').value);">Download Video</button>
    </div>
  <p><small>Or, <span style="color: #00F; cursor: pointer;" onclick="if (document.getElementById('url-input').disabled == true) {} else {document.getElementById('url-input').value = 'https:\/\/www.youtube.com\/watch?v=C0DPdy98e4c';}">load a test YouTube URL &#x2B0F;</span></small></p>
    <div id="file-format-options">
      <h2>Choose file format</h2>
      <select id="select-file-format">
        <option value="mp4" selected>MP4 (MPEG-4)</option>
        <option value="webm">WEBM (WebM)</option>
        <option value="flv">FLV (Flash Video)</option>
      </select>
    </div>
    <div id="video-options">
      <h2>Choose video resolution</h2>
      <select id="select-video-res">
        <option selected>Highest quality</option>
        <option value="1080p" disabled>1920&times;1080 (1080p / Full HD)</option>
        <option value="720p" disabled>1280&times;720 (720p / HD)</option>
      </select>
    </div>
    <div id="audio-only-options" style="display: none;">
      <h2>Choose audio format</h2>
      <select id="select-audio-format">
        <option selected>Best available</option>
      </select>
    </div>
    <h2>Log</h2>
    <div id="log"></div>
    <p><small>Powered by <a href="https://www.npmjs.com/package/ytdl-core" target="_blank">ytdl-core</a>. This project is <a href="https://github.com/CerebralDatabank/gopal-video-downloader" target="_blank">open source</a>.</small></p>
  </body>
  <script>
    function timestamp() {
      let thedate = new Date();
      let day = String(thedate.getDate());
      let month = String(thedate.getMonth() + 1);
      let year = String(thedate.getFullYear());
      let time = ("0" + (new Date()).getHours()).slice(-2) + ":" + ("0" + (new Date()).getMinutes()).slice(-2) + ":" + ("0" + (new Date()).getSeconds()).slice(-2);
      return `${year.padStart(2, "0")}-${month.padStart(2, "0")}-${day.padStart(2, "0")} ${time}`;
    }
    function log(logMessage) {
      document.getElementById("log").insertAdjacentHTML("beforeend", `<div>[${timestamp()}] ${logMessage}</div>`);
    }
    function disableAllInputs() {
      ["url-input", "url-input-submit", "select-file-format", "select-video-res", "select-audio-format"].forEach(elemId => {
        document.getElementById(elemId).disabled = true;
      });
    }
    function enableAllInputs() {
      ["url-input", "url-input-submit", "select-file-format", "select-video-res", "select-audio-format"].forEach(elemId => {
        document.getElementById(elemId).disabled = false;
      });
    }
    function processInput(urlInput) {
      disableAllInputs();
      log(`Processing input: ${urlInput}`);
      let chosenFileFormat = document.getElementById("select-file-format").options[document.getElementById("select-file-format").selectedIndex].value;
      if (!urlInput.includes("/")) {
        log("Input does not seem to be URL, prepending \"https://youtube.com/watch?v=\"");
        urlInput = `https://youtube.com/watch?v=${urlInput}`;
      }
      else {}
      log(`Final URL is: ${urlInput}`);
      log(`Final file format is: ${chosenFileFormat}`);
      log("Redirecting to download URL...");
      location.href = `./downloader?video_url=${urlInput}&file_format=${chosenFileFormat}`;
      enableAllInputs();
    }
  </script>
</html>